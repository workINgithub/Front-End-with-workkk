# 代理

#### 代理和网关的概念
代理是指，两个或多个使用同一种通信协议的应用程序
网关是连接两个或多个使用不同协议的端点 例如 雅虎邮件
但是 实际上这两者之间的区别很模糊，因为客户端和服务端使用协议版本不同，代理也需要转换协议


#### 代理的用途

**安全防火墙**

**Web缓存**
代理缓存维护了常用文档的本地副本，并将它们按需提供，以减少缓慢而昂贵的因特网通信。

**反向代理**
代理可以假扮web服务器。这些被称为替代物(surrogate)或反向代理(re-verse proxy)的代理接受发给Web服务器的
真实请求，但与Web服务器不同的是，它们可以发起与其他服务器的通信，以便按需定位所请求的内容。
可以用这些反向代理来提高访问慢速Web服务器上公共内容时的性能

**内容路由器**
代理服务器可以作为"内容服务器"使用，根据因特网流量状况以及内容类型将请求导向特定的web服务器
内容路由器也可以用来实现各种服务级的请求。比如，用户或内容提供者付费要求提供更高的性能，内容路由器
可以将请求转发到附近的复制缓存...

**转码器**

#### 代理服务器的部署
* 出口代理
* 访问(入口)代理 
  放置在ISP(Internet Service Provider)访问点上
* 反向代理
* 网络交换代理


#### 代理的层次结构
代理服务器被赋予父子的关系。下一个入口(inbound)代理(靠近服务)被称为父代理，下一个出口(outbound)代理(靠近服务端)被称为子代理

#### 使HTTP流向代理
* 修改客户端 (PAC文件，HTTP权威指南 第20章 )
* 修改网络(拦截代理，在修改网络基础的情况下，拦截客户端网络流量，并将其导入代理服务器中)
* 反向代理(替代物)，通过修改DNS的手段
* 修改web服务器，重定向


#### 追踪报文(via通用首部字段)
现在，在将Web请求从客户端传送到服务器的路径上，经过两个或多个代理是很常见的。

> via首部字段列出了与报文途径的每个节点(代理或网关)有关信息。报文每经过一个节点必需将这个中间节点，加到
via列表(属性)的尾部

作用: 记录转发 ， 诊断报文循环 ， 标示请求或响应链上所有发送或请求的能力
例如: Via: 1.1 proxy-62.irenes-isp.net, 1.0 cache.joes-hardware.com
经过两个节点 第一个是 proxy-62.irenes-isp.net HTTP/1.1
第二个是 cache.joes-hardware.com HTTP/1.0

**Via语法**
字段每个由逗号分割的值叫路标，每个路标都代表这一个代理或网关
路标组成：
* 协议名(可选，不是HTTP协议 得加上去)
* 协议版本
* 节点名(可以是假名)
* 节点注释(厂商和版本信息 、 包含一些诊断信息)
  
#### TRACE 方法
用户可以跟踪代理链传输的请求报文，报文经过了哪些代理，以及每个代理是如何对报文进行修改的。TRACE方法对代理流的调试非常有用。
当TRACE请求达到目的服务器时，整条请求报文都会封装在一个HTTP响应主体中会送到发送端。

**Max-Forwards**
最大转发次数。

#### OPTIONS：发现对可选特性的支持
通过该方法，客户端或代理服务器可以发现web服务器或某个特定资源的所支持的功能

具体看下请求行:
OPTIONS * HTTP/1.1 如果是* 则是请求整个web服务器的支持的HTTP方法
OPTIONS /specific/pathName HTTP/1.1 请求某个资源所支持的方法

**Allow**
Allow: GET , HEAD , PUT 所支持的方法列表