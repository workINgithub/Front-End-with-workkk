# 2020年01月18日 学习日记

浏览器缓存 与 http协议 有紧密联系

> 科普
> * expires 过期时间 响应首部字段
> * cache-control 缓存控制 通用首部字段
> * last-modified 上次修改时间 响应首部字段 对应的请求首部字段 if-modified-since
> * etag 标签 响应首部字段 对应的请求首部字段 if-none-match
> mac 刷新页面 command+R 强制刷新 cmmand+shift+R

#### expires
HTTP/1.0 一般服务器返回的指令(属性)都是 **Sun, 19 Jan 2020 02:13:30 GMT**
很好理解,一旦本地时间超过了过期时间，浏览器就得重新获取指定资源，而未过期就拿缓存中的资源
但有缺点，本地时间和服务器时间很有可能是不同步的。设置这个字段可能根本没作用。

#### cache-control
http/1.1 这个字段有很多指令(属性),这里着重讲下max-age
它设置了相对的时间，也就是把资源储存到缓存后，对资源计时。超过缓存时间了,则重新获取,否则拿
缓存中的资源
改善了绝对时间的情况，但是假设缓存资源没有在服务器中修改，再次请求就占用了服务器的资源

> 未命中强缓存后，通过以下字段重新请求(协商缓存)

#### last-modified
为了改善占用服务器资源的问题。服务器在响应首部中添加这个字段，例如 last-modified: Tue, 15 Oct 2019 10:49:03 GMT。 那么对应的浏览器在重新发起请求后,请求首部添加**if-modified-since: Tue, 15 Oct 2019 10:49:03 GMT**。假设服务器的对应资源未修改则返回状态为304的响应，否则修改了那返回状态码为200的响应。
优点: 有效的降低了服务器的资源占用率
缺点: 上次修改时间不精确，不能明显表明资源的修改情况。
1. 1s内多次修改，服务器无法传送最新的文件
2. 修改后内容和原资源相同，服务器依然会发送资源


#### etag
为了改善上述的情况,用编码表示一个文件。服务器在响应首部添加etag字段。浏览器重新发起请求，请求首部添加**if-none-match** 字段。假设匹配则返回304，不匹配发送新资源，200
优点:精确判断了文件是否被修改的情况