#  两个视口的故事（桌面端和移动端）

> 在这个小系列里，我将会解释各种重要的元素的视口和宽度的是如何工作的。例如html元素，或是window或屏幕。

这篇文章是关于桌面级浏览器，它的唯一目的是给移动端浏览器打下基础。大多数web开发者已经可以直观的理解大多数桌面级浏览器的概念了。在移动端，我们会找到同样的概念，但是更加复杂。但是在探究移动端之前，讨论每个人都知道的术语，会帮助你理解移动端浏览器。

### 概念：设备像素和css像素

第一个拿你需要理解的概念是css像素，以及它与设备像素的不同点。

设备像素是我们直观上认为是正确的那种像素。这种像素提供你正在使用的任何设备的形式分辨率，并且可以从screen.width/height中读出。

如果你声明一个元素的宽度是128px，而且你的监视器是1024px宽度，并且你最大化你的浏览器屏幕，那么8个这样的元素可以填满你的显示器（大致地：先暂时忽略一些棘手的问题。）。

但是，如果用户变焦`zoom`了，则计算将会改变。如果用户变焦到200%，你拥有的128px宽度的元素，只能在其1024px的显示器上容纳4次。

在现代浏览器中实现变焦`zoom`只是通过"扩展"像素罢了。也就是说，元素的宽度不会从128px更改为256px，相反实际像素的大小增加了一倍。形式上，即使元素恰好占用256个设备像素的空间，它的宽度仍为128 CSS px。

换句话说，缩放到200%,可使一个css像素增长到一个设备像素大小的4倍。（宽度的两倍，高度的两倍，总共产生4倍）。

一些图像证明这个概念。这里有4个像素点在100%缩放`zoom`级别。这里没啥可看的，css像素和设备像素完全重叠。

现在让我们缩小，css像素开始缩小，这意味着一个设备像素现在与几个css像素重叠。

但你如果放大，则是相反的结果。css像素开始增长，现在一个css像素与几个设备像素重叠。

关键点是，你仅仅对css像素感兴趣，这些像素决定了样式表的呈现方式。设备像素对您几乎完全无用。 （设备像素）不是给用户设计的； 用户会放大或缩小页面，直到可以舒适地阅读为止。 但是，缩放比例对您来说并不重要。 浏览器将自动确保您的CSS布局被拉伸或压缩。



### 100% zoom

我以假设缩放比例为100%开始，是时候定义的更严格。

> 在变焦`zoom`级别是100%时，一个css像素就等于1个设备像素。

在接下来的说明中，“ 100％缩放”的概念非常有用，但是您在日常工作中不必过分担心。 在台式机上，您通常会以100％的缩放比例测试网站，但是即使用户放大或缩小CSS像素的魔力，也可以确保您的布局保持相同的比例。

### 屏幕尺寸(设备像素)

让我们看一些实际的测量。 我们将从screen.width和screen.height开始。 它们包含用户屏幕的总宽度和高度。 这些尺寸以设备像素为单位进行度量，因为它们从未改变：它们是显示器的功能，而不是浏览器的功能。

### 窗口尺寸（css像素）

相反，您想知道的是浏览器窗口的内部尺寸。确切地告诉您用户当前有多少空间可用于CSS布局。您可以在window.innerWidth和window.innerHeight中找到这些尺寸。

显然，**窗口的内部宽度以CSS像素为单位**。 您需要知道可以将多少布局压缩到浏览器窗口中，并且该数量会随着用户放大而减少。因此，如果用户放大，则窗口中的可用空间会减少，而window.innerWidth / Height反映了这一点。 通过减少。

（这里是Opera的例外，在Opera中，用户放大时window.innerWidth / Height不会降低：以设备像素为单位。这在台式机上很烦人，但在移动设备上却很致命，我们将在后面介绍。）

请注意，测量的宽度和高度包括滚动条。 它们也被视为内部窗口的一部分。 （这主要是出于历史原因。）

### 滚动偏移（css像素）

window.pageXOffset和window.pageYOffset包含文档的水平和垂直滚动偏移量。 因此，您可以找出用户滚动了多少。

这些属性也以CSS像素为单位。 您想知道已经滚动了多少文档，无论其处于什么缩放状态。

从理论上讲，如果用户向上滚动然后放大，则window.pageX / YOffset将会更改。 但是，浏览器尝试通过在用户缩放时在可见页面的顶部保留相同的元素来使网页保持一致。 这并不总是完美的，但这意味着在实践中window.pageX / YOffset并没有真正改变：从窗口中滚动出的CSS像素数量保持（大致）相同。

### 概念：视口

在继续使用更多JavaScript属性之前，我们必须引入另一个概念：视口。

视口的功能是约束<html>元素，该元素是您网站的最上层的容纳块。

这听起来可能有点含糊，所以这里有一个实际的例子。 假设您有一个流体布局，并且其中一个侧边栏的宽度为10％。 现在，随着您调整浏览器窗口的大小，边栏会整齐地增长和收缩。 但是究竟是如何工作的呢？

从技术上讲，发生的事情是侧边栏获得其父级宽度的10％。 假设（父级元素）这是<body>（并且您没有为其指定宽度）。 因此，问题变成<body>具有哪个宽度。

通常，所有块级元素都占用其父级宽度的100％（有例外，但现在暂时忽略它们）。 因此，<body>与其父元素<html>一样宽。

而<html>元素的宽度是多少？ 为什么，它和浏览器窗口一样宽。 这就是为什么宽度为10％的侧边栏将占整个浏览器窗口的10％。 所有Web开发人员都直观地知道并使用此事实。

您可能不知道这在理论上是如何工作的。 从理论上讲，<html>元素的宽度受视口宽度的限制。 <html>元素占据该视口宽度的100％。

视口又恰好等于浏览器窗口：视口就是这样定义的。**视口不是HTML构造，因此不能受CSS影响。** 它只是在桌面上具有**浏览器窗口的宽度和高度**。 在移动设备上，它要复杂得多。

### 后果

这种状况有一些奇怪的后果。 您可以在此站点上看到其中之一。

1. 一直滚动到顶部。
2. 然后放大，以使该站点的内容溢出浏览器窗口。[站点链接](https://www.quirksmode.org/mobile/viewports.html)

现在，向右滚动，您会发现网站顶部的蓝色栏不再正确对齐。

此行为是视口定义方式的结果。 我在顶部的蓝色条上设置了宽度：100％。 100％是什么？ 与视口一样宽的<html>元素，与浏览器窗口一样宽。

重点是：虽然这在100％缩放时可以正常工作，但是现在我们放大的视口已变得小于网站的总宽度。 本身没关系，内容现在会从<html>元素溢出，但是该元素已溢出：可见，这意味着无论如何都将显示溢出的内容。

但是蓝色条不会溢出。 我给它一个宽度：毕竟是100％，浏览器通过给它提供视口的宽度来服从。 他们不在乎那个宽度现在太窄了。

### 文档宽度

我真正需要知道的是页面总内容的宽度，包括“伸出”的部分。据我所知，不可能找到该值（好吧，除非您计算页面上所有元素的宽度和边距，但是这很容易出错）。

我开始相信我们需要一个JavaScript属性键值对，该属性对应提供所谓的“文档宽度”（显然，以CSS像素为单位）。

如果我们真的很时髦，为什么不还将此值暴露给CSS？我希望能够设置宽度：蓝色条形图的100％取决于文档的宽度，而不是<html>元素的宽度。 （不过，这注定是棘手的，如果无法实现，我也不会感到惊讶。）

浏览器供应商，您如何看待？

### 测量视口（css像素）

你可能想知道视口的尺寸。它们可以在html对象的clientHeight和clientWidth中找到。

如果您熟悉DOM，则知道document.documentElement实际上是<html>元素：任何HTML文档的根元素。但是，可以说，视口要高一层。**它是包含<html>元素的元素**。如果给<html>元素设置宽度，那可能很重要。 （顺便提一下，我不建议这样做，但是有可能。）

在这种情况下，document.documentElement.clientWidth和-Height仍提供视口的尺寸，而不是<html>元素的尺寸。 （这是一条特殊规则，仅适用于此元素，仅适用于此属性键值对。在所有其他情况下，将使用元素的实际宽度。）

所以html元素始终给的是视口的尺寸，而不是html根元素的尺寸呢。

### 测量html元素（css像素）

所以`clientWidth/clientHeight`提供了视口的尺寸。但我们可以从哪里找到html元素的尺寸？它们被存放在`document.documentElement.offsetWidth/Height`中。你可以设置html元素的宽度，offsetWIdth将反映出来。

> 译者注：当用户缩放视口时，视口的尺寸也会相应作出改变。例如缩放到50%，视口的宽度是原先的两倍。

### 事件坐标

然后是事件坐标。发生鼠标事件时，将公开不少于五个属性键值对，以提供有关事件确切位置的信息。对于我们的讨论，其中三个很重要：

1. `pageX/Y`提供了相对于html元素的坐标，单位css像素
2. `clientX/Y`提供了相对于视口的坐标，单位css像素
3. `screenX/Y`提供了相对于屏幕的坐标，单位device像素

您将有90％的时间使用pageX / Y；通常您想知道事件相对于文档的位置。您将有10％的时间使用clientX / Y。您永远都不需要知道相对于屏幕的事件坐标。

### 媒体查询符

最后，关于媒体查询的一些话。这个想法很简单：您可以定义特殊的CSS规则，仅在页面宽度大于，等于或小于特定大小时才执行。例如：

```css
div.sidebar {
	width: 300px;
}

@media all and (max-width: 400px) {
	// styles assigned when width is smaller than 400px;
	div.sidebar {
		width: 100px;
	}

}
```

现在，边栏为300px宽，除非屏幕宽度小于400px，在这种情况下，边栏变为100px宽。 问题当然是：我们在这里测量哪个宽度？ 有两个相关的媒体查询：width / height和device-width / device-height。

您应该使用哪个？这很容易：宽度width，当然。 Web开发人员对设备的宽度不感兴趣。至关重要的是浏览器窗口的宽度。

因此，在台式机上使用width并忽略device-width。如我们所见，在移动设备上情况更加混乱。

### 总结

到此结束了我们对桌面浏览器行为的尝试。本系列的第二部分将这些概念移植到移动设备上，并强调了与台式机的一些重要区别。